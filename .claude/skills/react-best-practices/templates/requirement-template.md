# React 项目需求文档模板

> 本模板用于编写 React 前端功能需求文档，确保需求清晰、可实现、可测试。

**文档信息**:
- 项目名称：[项目名称]
- 功能名称：[功能名称]
- 编写人员：[姓名]
- 编写日期：[YYYY-MM-DD]
- 文档版本：v1.0

---

## 1. 功能概述

### 1.1 功能简介

简要描述本功能的目的和价值（2-3 句话）。

**示例**:
> 本功能实现用户个人资料页面，允许用户查看和编辑自己的个人信息，包括头像、昵称、简介等。通过该功能，用户可以个性化展示自己，提升社区互动体验。

### 1.2 业务背景

说明为什么需要这个功能，解决什么问题。

**示例**:
- 当前用户无法修改个人信息，导致信息过时
- 用户希望能够个性化展示自己
- 提升用户活跃度和归属感

### 1.3 目标用户

**主要用户**：[描述主要使用该功能的用户群体]

**使用场景**：
- 场景 1：[具体使用场景]
- 场景 2：[具体使用场景]
- 场景 3：[具体使用场景]

---

## 2. 用户故事

### 2.1 核心用户故事

按照 "作为...，我想要...，以便..." 的格式编写：

**用户故事 1**:
```
作为 一个注册用户
我想要 查看和编辑我的个人资料
以便 其他用户能够了解我，并且保持我的信息最新
```

**验收标准**:
- [ ] 用户可以查看自己的个人资料页面
- [ ] 用户可以编辑昵称、简介、头像
- [ ] 保存后立即生效
- [ ] 其他用户可以看到更新后的信息

**用户故事 2**:
```
作为 一个注册用户
我想要 上传自定义头像
以便 个性化展示自己
```

**验收标准**:
- [ ] 支持上传 JPG、PNG 格式图片
- [ ] 图片大小限制 5MB
- [ ] 自动裁剪为正方形
- [ ] 提供图片预览功能

### 2.2 扩展用户故事（可选功能）

如有扩展功能，在此列出：

**用户故事 3**（优先级：低）:
```
作为 一个高级用户
我想要 自定义个人资料背景图
以便 让我的主页更加个性化
```

---

## 3. UI/UX 需求

### 3.1 页面结构

```
用户资料页面
├── 页面头部
│   ├── 背景图（可选）
│   ├── 用户头像
│   ├── 用户昵称
│   └── 编辑按钮
├── 资料卡片
│   ├── 基本信息
│   ├── 统计数据（粉丝、关注、帖子数）
│   └── 个人简介
└── 内容区域
    ├── Tab 导航（帖子、收藏、关注等）
    └── 内容列表
```

### 3.2 交互流程

**查看个人资料流程**:
```
1. 用户点击"我的资料"
2. 跳转到个人资料页面
3. 加载用户信息（显示骨架屏）
4. 显示完整资料
```

**编辑个人资料流程**:
```
1. 用户点击"编辑"按钮
2. 切换到编辑模式（表单）
3. 用户修改信息
4. 用户点击"保存"
5. 提交到后端（显示 loading）
6. 显示成功提示
7. 更新页面显示
```

### 3.3 交互细节

**加载状态**:
- 初次加载显示骨架屏（Skeleton）
- 保存时按钮显示 loading 状态
- 上传图片时显示进度条

**错误处理**:
- 表单验证失败显示错误提示
- API 请求失败显示 Toast 提示
- 图片上传失败提供重试选项

**成功反馈**:
- 保存成功显示 Toast 提示："保存成功"
- 头像上传成功立即更新显示

### 3.4 响应式设计

| 屏幕尺寸 | 布局 | 特殊处理 |
|---------|------|---------|
| 桌面（> 1024px） | 双列布局，左侧资料卡，右侧内容 | - |
| 平板（768-1024px） | 单列布局，资料卡置顶 | - |
| 移动（< 768px） | 单列布局，头像缩小 | 编辑按钮显示为图标 |

---

## 4. 功能需求

### 4.1 核心功能

#### 功能 1：查看个人资料

**描述**：用户可以查看自己和他人的个人资料页面

**功能点**：
- 显示用户基本信息（头像、昵称、简介）
- 显示用户统计数据（粉丝数、关注数、帖子数）
- 显示用户动态列表

**前端实现要点**：
- 使用 TanStack Query 缓存用户数据（5 分钟）
- 骨架屏加载状态
- 图片懒加载

#### 功能 2：编辑个人资料

**描述**：用户可以修改自己的个人信息

**可编辑字段**：
| 字段 | 类型 | 验证规则 | 必填 |
|------|------|---------|------|
| 昵称 | 文本 | 2-20 个字符 | ✅ |
| 简介 | 文本域 | 最多 200 字符 | ❌ |
| 头像 | 图片 | JPG/PNG，最大 5MB | ❌ |

**前端实现要点**：
- 使用 React Hook Form + Zod 验证
- 实时字数统计（简介）
- 图片裁剪预览（react-image-crop）

#### 功能 3：上传头像

**描述**：用户可以上传并裁剪自定义头像

**功能点**：
- 点击头像打开文件选择器
- 预览上传的图片
- 裁剪为正方形（1:1 比例）
- 保存并更新头像

**技术要求**：
- 支持拖拽上传
- 客户端图片压缩（< 500KB）
- 显示上传进度

### 4.2 非功能需求

**性能要求**：
- 首屏加载时间 < 2 秒
- 图片上传响应时间 < 3 秒
- 保存个人资料响应时间 < 1 秒

**可用性要求**：
- 支持键盘导航
- 表单字段支持自动填充
- 错误提示清晰易懂

**兼容性要求**：
- 浏览器：Chrome 90+、Firefox 88+、Safari 14+
- 移动端：iOS 13+、Android 8+

---

## 5. API 接口定义

### 5.1 获取用户资料

```typescript
GET /api/users/:userId

// 响应
{
  "id": "123",
  "name": "张三",
  "email": "zhangsan@example.com",
  "avatar": "https://cdn.example.com/avatars/123.jpg",
  "bio": "这是我的个人简介",
  "stats": {
    "followers": 100,
    "following": 50,
    "posts": 20
  },
  "createdAt": "2024-01-01T00:00:00Z"
}
```

### 5.2 更新用户资料

```typescript
PATCH /api/users/:userId

// 请求体
{
  "name": "李四",
  "bio": "更新后的简介"
}

// 响应
{
  "id": "123",
  "name": "李四",
  "bio": "更新后的简介",
  "updatedAt": "2024-12-24T12:00:00Z"
}
```

### 5.3 上传头像

```typescript
POST /api/users/:userId/avatar

// 请求（multipart/form-data）
{
  "avatar": File
}

// 响应
{
  "avatar": "https://cdn.example.com/avatars/123-new.jpg"
}
```

### 5.4 错误响应

```typescript
// 通用错误格式
{
  "error": {
    "code": "VALIDATION_ERROR",
    "message": "昵称长度必须在 2-20 个字符之间",
    "field": "name"
  }
}
```

---

## 6. 数据模型

### 6.1 User 类型

```typescript
interface User {
  id: string
  name: string
  email: string
  avatar: string
  bio: string
  stats: {
    followers: number
    following: number
    posts: number
  }
  createdAt: string
  updatedAt: string
}
```

### 6.2 UpdateUserDto 类型

```typescript
interface UpdateUserDto {
  name?: string
  bio?: string
}
```

---

## 7. 验收标准

### 7.1 功能验收

**必须满足**：
- [ ] 用户可以正常查看个人资料页面
- [ ] 用户可以编辑昵称和简介
- [ ] 用户可以上传并裁剪头像
- [ ] 所有表单验证正常工作
- [ ] 加载状态显示正常
- [ ] 错误提示友好清晰
- [ ] 保存后立即更新显示

**可选功能**：
- [ ] 支持拖拽上传头像
- [ ] 实时保存草稿

### 7.2 技术验收

- [ ] TypeScript 类型完整，无 any
- [ ] 单元测试覆盖率 > 80%
- [ ] E2E 测试通过
- [ ] ESLint 检查无错误
- [ ] Lighthouse 性能评分 > 90
- [ ] 无 console 警告或错误

### 7.3 UI/UX 验收

- [ ] 设计稿 100% 还原
- [ ] 响应式布局在所有设备正常显示
- [ ] 动画流畅（60fps）
- [ ] 交互反馈及时

---

## 8. 技术实现建议

### 8.1 技术选型

| 技术点 | 推荐方案 | 说明 |
|-------|---------|------|
| 表单管理 | React Hook Form + Zod | 性能好，类型安全 |
| 图片上传 | react-dropzone | 支持拖拽 |
| 图片裁剪 | react-image-crop | 易用性好 |
| 状态管理 | TanStack Query | 缓存用户数据 |

### 8.2 文件组织

```
src/features/user-profile/
├── UserProfilePage.tsx          # 页面组件
├── components/
│   ├── UserHeader.tsx           # 用户头部
│   ├── UserStats.tsx            # 统计数据
│   ├── EditProfileForm.tsx      # 编辑表单
│   └── AvatarUpload.tsx         # 头像上传
├── hooks/
│   ├── useUserProfile.ts        # 获取用户数据
│   ├── useUpdateUser.ts         # 更新用户
│   └── useUploadAvatar.ts       # 上传头像
├── api/
│   └── userApi.ts               # API 请求
└── types/
    └── user.types.ts            # 类型定义
```

### 8.3 注意事项

1. **图片优化**：上传前在客户端压缩图片，减少带宽消耗
2. **缓存策略**：用户数据缓存 5 分钟，减少 API 请求
3. **错误处理**：统一的错误处理逻辑，友好的错误提示
4. **无障碍访问**：表单字段添加 aria-label，支持键盘导航

---

## 9. 测试计划

### 9.1 单元测试

- [ ] useUserProfile hook 测试
- [ ] useUpdateUser hook 测试
- [ ] 表单验证逻辑测试

### 9.2 组件测试

- [ ] UserHeader 渲染测试
- [ ] EditProfileForm 交互测试
- [ ] AvatarUpload 上传测试

### 9.3 E2E 测试

- [ ] 完整的查看个人资料流程
- [ ] 完整的编辑个人资料流程
- [ ] 头像上传和裁剪流程

---

## 10. 时间估算

| 任务 | 预计时间 | 说明 |
|------|---------|------|
| UI 开发 | 2 天 | 页面布局、组件实现 |
| 逻辑开发 | 1 天 | API 集成、状态管理 |
| 测试 | 1 天 | 单元测试、E2E 测试 |
| 优化 | 0.5 天 | 性能优化、细节调整 |
| **总计** | **4.5 天** | - |

---

## 11. 风险和依赖

### 11.1 风险

| 风险 | 影响 | 应对措施 |
|------|------|---------|
| 后端 API 延迟 | 高 | 使用 Mock 数据先行开发 |
| 图片上传失败率高 | 中 | 添加重试机制 |
| 设计稿频繁变更 | 中 | 与设计师确认最终版本 |

### 11.2 依赖

- [ ] 后端 API 接口已完成
- [ ] CDN 服务已配置（图片存储）
- [ ] 设计稿已确认

---

## 12. 更新记录

| 版本 | 日期 | 修改内容 | 修改人 |
|------|------|---------|--------|
| v1.0 | 2024-12-24 | 初始版本 | [姓名] |

---

**文档状态**: [ ] 草稿  [ ] 评审中  [ ] 已通过  [ ] 已实现

**相关文档**:
- [组件设计文档](./component-template.md)
- [架构设计文档](../architecture-design.md)
